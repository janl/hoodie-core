#!/usr/bin/env node
var cli = require("cli");
var daemon = require("daemonize2");

var commands = {};
commands.usage = function usage(cmd)
{
    if(cmd !== "usage") {
        console.log("Unknown command '%s'\n", cmd);
    }
    console.log("Usage: hoodie cmd");
    console.log("cmd is one of:");
    console.log("  service-start  Starts the Hoodie service");
    console.log("  usage          Prints this screen")
}

commands["service-start"] = function service_start()
{
    console.log("Starting Hoodie");
    var service = get_hoodie_service();
    service.start();
}

commands["service-stop"] = function service_stop()
{
    console.log("Stopping Hoodie");
    var service = get_hoodie_service();
    service.stop();
}

var get_hoodie_service = function get_hoodie_service()
{
    return daemon.setup({
        main: "./bin/hoodie-service.js",
        name: "service-start.js",
        pidfile: "/tmp/hoodie-servide.pid"
    });
}

// main

cli.main(function(args, options) {
    var cmd = args[0] || "usage";
    if(!commands[cmd]) {
        commands.usage(cmd);
        return;
    }
    commands[cmd](cmd);
});
